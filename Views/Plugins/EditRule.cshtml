@model MachineLinkConfig.Controllers.EditRuleVm

@{
    ViewData["Title"] = "Modifica regola";
}

<div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
    <div>
        <h2 style="margin:0;">Modifica regola</h2>
        <div class="text-muted">Plugin: <code>@Model.PluginName</code></div>
    </div>
    <a class="btn btn-secondary" href="/plugins/@Model.PluginId/rules">← Regole</a>
</div>

<hr />

<form method="post" action="/plugins/@Model.PluginId/rules/@Model.RuleId/edit" style="max-width:900px;">
    @Html.AntiForgeryToken()

    <div class="row g-2">
        <div class="col-md-3">
            <label class="form-label">RuleType</label>
            <select class="form-select" name="RuleType" id="ruleType">
                @if (Model.RuleType == "MUTEX")
                {
                    <option value="MUTEX" selected>MUTEX</option>
                }
                else
                {
                    <option value="MUTEX">MUTEX</option>
                }
                @if (Model.RuleType == "REQUIRE")
                {
                    <option value="REQUIRE" selected>REQUIRE</option>
                }
                else
                {
                    <option value="REQUIRE">REQUIRE</option>
                }
                @if (Model.RuleType == "FORCE_VALUE")
                {
                    <option value="FORCE_VALUE" selected>FORCE_VALUE</option>
                }
                else
                {
                    <option value="FORCE_VALUE">FORCE_VALUE</option>
                }
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">IF (KeySuffix o Flag)</label>
            <input class="form-control" name="IfParamKeySuffix" value="@Model.IfParamKeySuffix" />
        </div>

        <div class="col-md-3">
            <label class="form-label">THEN (KeySuffix)</label>
            <input class="form-control" name="ThenParamKeySuffix" value="@Model.ThenParamKeySuffix" />
        </div>

        <div class="col-md-3" id="forcedBlock">
            <label class="form-label">Forced Value</label>
            <input class="form-control" name="ForcedValue" value="@(Model.ForcedValue ?? "")" />
        </div>

        <div class="col-12">
            <label class="form-label">Descrizione (opzionale)</label>
            <input class="form-control" name="Description" value="@(Model.Description ?? "")" />
        </div>
    </div>

    <div class="text-danger" style="margin-top:8px;">
        @Html.ValidationSummary()
    </div>

    <button class="btn btn-primary" type="submit" style="margin-top:10px;">Salva</button>
</form>

<script>
    const ruleType = document.getElementById('ruleType');
    const forced = document.getElementById('forcedBlock');

    function refresh() {
        forced.style.display = (ruleType.value === 'FORCE_VALUE') ? 'block' : 'none';
    }
    ruleType.addEventListener('change', refresh);
    refresh();
</script>
